{"version":3,"file":"app.js","mappings":";;;;;AAAA;AACA;AACA;AACA;AACA,CAAC;;AAED,iBAAiB;AACjB;AACA,mDAAmD;;AAEnD;AACA;AACA,MAAM;AACN;AACA,MAAM;AACN;AACA,MAAM;AACN;AACA,MAAM;AACN;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,oBAAoB;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,KAAK;AACL;AACA,aAAa;AACb,uBAAuB;AACvB;AACA,eAAe;AACf;AACA,eAAe;AACf;AACA,gBAAgB;AAChB;AACA;AACA;AACA;AACA;AACA,wDAAwD,8CAA8C;AACtG,oDAAoD,8CAA8C;AAClG,sDAAsD,8CAA8C;AACpG;AACA;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6EAA6E,gCAAgC;AAC7G;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA,oBAAoB,6BAA6B;AACjD;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,4DAA4D,4BAA4B;AACxF;AACA;AACA,KAAK;AACL;AACA;AACA,0DAA0D,4BAA4B;AACtF;AACA;AACA,KAAK;AACL;AACA;AACA,2DAA2D,4BAA4B;AACvF;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,KAAK;AACL,C","sources":["webpack://gajwa-playground/./public/project.js"],"sourcesContent":["// const FontFaceObserver = require('fontfaceobserver');\nlet font = new FontFaceObserver('dgm');\nfont.load().then(function () {\n    console.log('font' ,font.family , 'loaded');\n});\n\nconst display = {width : 360, height: 680};\nfunction device(){\n    let varUA = navigator.userAgent.toLowerCase(); //userAgent 값 얻기\n\n    if ( varUA.indexOf('android') > -1) {\n        return \"안드로이드\";\n    } else if ( varUA.indexOf(\"iphone\") > -1||varUA.indexOf(\"ipad\") > -1||varUA.indexOf(\"ipod\") > -1 ) {\n        return \"아이폰\";\n    } else if ( varUA.indexOf(\"mac\") > -1) {\n        return \"맥\";\n    } else if ( varUA.indexOf(\"windows\") > -1) {\n        return \"컴퓨터\";\n    } else {\n        return \"기계\";\n    }\n}\n\nconst config = {\n    type: Phaser.AUTO,\n    width: display.width,\n    height: display.height,\n    physics: {\n        default: 'arcade',\n        arcade: {\n            //debug: true\n        }\n    },\n    scene: {\n        preload: preload,\n        create: create,\n        update: update\n    },\n    parent: 'canvas',\n    pixelArt: true,\n};\nconst fontConfig = {font: '32px \"dgm\"', color: '#fff'};\nconst game = new Phaser.Game(config);\n// TODO: 게임 상태 변경\nlet gameStatus = {\n    Chapter: 'load',\n    Index: 0,\n    get chapter(){\n        return this.Chapter;\n    },\n    set chapter(value) {\n        this.Chapter = value;\n        if(value === 'story') story();\n        else if(value.split(\"-\")[0] === 'chapter') chapter(value.split(\"-\")[1]);\n        myLog.text = this.Chapter + \"-\" + this.Index;\n    },\n    get idx(){\n        return this.Index;\n    },\n    set idx(value) {\n        this.Index = value;\n        myLog.text = this.Chapter + \"-\" + this.Index;\n    },\n};\nlet myLog = {text: null};\nconst mainObjConfig = {characterMove: false};\nconst mainObject = {};\nconst touch = {x: 0, y: 0};\nconst chapterTitle = [];\nconst line = { story: [], chapter: [] };\nconst ui = {};\nconst timer = { shaker: null };\n// TODO: * 프리로드\nfunction preload ()\n{\n    this.load.json('line', 'data/line.json');\n    this.load.image('talkbox', 'image/talkbox.png');\n    this.load.spritesheet('stand', 'image/stand.png', { frameWidth: 32, frameHeight: 32, endFrame: 1 });\n    this.load.spritesheet('run', 'image/run.png', { frameWidth: 32, frameHeight: 32, endFrame: 3 });\n    this.load.spritesheet('seek', 'image/seek.png', { frameWidth: 32, frameHeight: 32, endFrame: 1 });\n// plugin load\n    var url_nine = 'https://raw.githubusercontent.com/rexrainbow/phaser3-rex-notes/master/dist/rexninepatchplugin.min.js';\n    this.load.plugin('rexninepatchplugin', url_nine, true);\n}\nconst gameManager = {status: 'ready'};\nfunction create () {\n    gameStatus.chapter = 'main';\n    gameStatus.idx = 0;\n    // TODO: LOG TEXT\n    myLog = this.add.text(8, 8, 'main-0', fontConfig).setFontSize(16);\n    // 터치 포인터 위치 리턴\n    this.input.on('pointerup', function (pointer)\n    {\n        touch.x = pointer.x;\n        touch.y = pointer.y;\n        function charMove() {\n            mainObject.character.setFlipX(pointer.x < mainObject.character.x);\n            game.scene.scenes[0].physics.moveToObject(mainObject.character, {x: pointer.x, y: pointer.y - 32}, 180);\n            mainObject.character.play('run');\n        }\n        if(mainObjConfig.characterMove === true) charMove();\n    }, this);\n\n    // TODO: JSON LINES TO ARRAY\n    let lineJson = this.cache.json.get('line');\n    for (let l = 0; l < lineJson.chapter.length; l++) {\n        chapterTitle.push(lineJson.chapter[l]);\n    }\n    // line Json 첫번째 배열: 챕터별 라인, 두번째 배열: 라인 당 개별 대사\n    line.story = lineJson.line.story;\n    console.log(line);\n\n    ui.startgame = this.add.text(0, 0, 'Start Game', fontConfig);\n    InitObject(ui.startgame, display.width * 0.5, display.height * 0.5, 0.5, true);\n    ui.startgame.on('pointerup', function () {\n        this.disableInteractive();\n        game.scene.scenes[0].tweens.add({\n            targets: ui.startgame,\n            alpha: 0,\n            duration: 800,\n            onComplete: () => gameStatus.chapter = 'story'\n        });\n    });\n    // TODO: 스토리 시작 메인 텍스트 설정\n    ui.mainText = this.add.text(0, 0, line.story[0][0], fontConfig).setVisible(false).setAlign('center');\n    InitObject(ui.mainText, display.width * 0.5, display.height * 0.5, 0.5,true);\n    ui.mainText.on('pointerup', function () {\n        gameStatus.idx++;\n        this.text = line.story[0][gameStatus.idx];\n        ShakeObject(this, 20, 20, 240);\n        if(gameStatus.idx >= line.story[0].length) {\n            gameStatus.chapter = 'chapter-1';\n            gameStatus.idx = 0;\n        }\n    });\n    // TODO: 챕터 타이틀 텍스트 설정\n    ui.chapterText = this.add.text(0, 0, chapterTitle[0], fontConfig).setVisible(false).setAlign('center');\n    InitObject(ui.chapterText, display.width * 0.5, display.height * 0.5, 0.5,true);\n\n    // TODO: 메인 대화창 설정\n    ui.talkBox = this.add.rexNinePatch({\n        x: display.width * 0.5, y: display.height - 120,\n        width: display.width - 20, height: 180,\n        key: 'talkbox',\n        columns: [16, undefined, 16],\n        rows: [16, undefined, 16],\n    }).setVisible(false).setInteractive();\n    ui.talkBox.on('pointerup', function () {\n        game.scene.scenes[0].time.removeAllEvents();\n        if(line.story[1].length - 1 > gameStatus.idx) {\n            gameStatus.idx++;\n            if(gameStatus.idx === 4) mainObject.character.play('seek');\n            else if(gameStatus.idx === 5) mainObject.character.play('stand');\n        }\n        else {\n            setTimeout(() => mainObjConfig.characterMove = true, 60);\n            ui.talkText.setVisible(false);\n            ui.talkBox.setVisible(false);\n            ui.taskText.setVisible(true);\n        }\n        ui.talkText.text = '';\n        typewriteText(ui.talkText, line.story[1][gameStatus.idx], 60);\n    });\n    ui.talkText = this.add.text(0, 0, '', fontConfig).setVisible(true).setAlign('left').setFontSize(16);\n    InitObject(ui.talkText, 40, display.height - 180, 0,false);\n    // TODO: 미션 텍스트\n    ui.taskText = this.add.text(0, 0, '목소리가 나는 곳을 찾아보자.', fontConfig).setVisible(false).setAlign('left').setFontSize(16);\n    InitObject(ui.taskText, display.width * 0.5, 60, 0.5,false);\n    // TODO: 캐릭터 생성\n    setAnims();\n    mainObject.character = this.physics.add.sprite(display.width * 0.5, display.height * 0.5, 'stand')\n        .play('stand').setScale(2).setVisible(false);\n\n    mainObject.layer = this.add.layer();\n    mainObject.layer.add(mainObject.character);\n    mainObject.layer.add(ui.talkBox);\n    mainObject.layer.add(ui.talkText);\n    mainObject.layer.add(ui.taskText);\n}\n// TODO: 애니메이션 추가\nfunction setAnims() {\n    var scene = game.scene.scenes[0];\n    scene.anims.create({\n        key: 'stand',\n        frames: scene.anims.generateFrameNumbers('stand', { start: 0, end: 1, first: 0 }),\n        frameRate: 4,\n        repeat: -1\n    });\n    scene.anims.create({\n        key: 'run',\n        frames: scene.anims.generateFrameNumbers('run', { start: 0, end: 3, first: 0 }),\n        frameRate: 8,\n        repeat: -1\n    });\n    scene.anims.create({\n        key: 'seek',\n        frames: scene.anims.generateFrameNumbers('seek', { start: 0, end: 1, first: 0 }),\n        frameRate: 2,\n        repeat: -1\n    });\n}\nfunction story() {\n    // TODO: 스토리 시작\n    console.log('스토리 시작');\n    ui.mainText.setVisible(true);\n    ShakeObject(ui.mainText, 20, 20, 240);\n}\nfunction chapter(chapterNum) {\n    // TODO: 챕터 시작\n    console.log('챕터', chapterNum, '시작');\n    ui.mainText.setVisible(false);\n    ui.chapterText.setVisible(true);\n    ui.chapterText.alpha = 0;\n    game.scene.scenes[0].tweens.add({\n        targets: ui.chapterText,\n        alpha: 1,\n        duration: 2400,\n        yoyo: true,\n        ease: Phaser.Math.Easing.Elastic.InOut,\n        onComplete: startChapter\n    });\n    function startChapter() {\n        ui.talkBox.setVisible(true);\n        mainObject.character.setVisible(true).setAlpha(0);\n        game.scene.scenes[0].tweens.add({\n            targets: mainObject.character,\n            alpha: 1,\n            duration: 3200,\n            ease: 'linear'\n        });\n        typewriteText(ui.talkText, line.story[1][0], 100);\n    }\n}\n\nfunction update () {\n    // 터치 포지션 근접시 리셋\n    let distance = Phaser.Math.Distance.Between(mainObject.character.x, mainObject.character.y, touch.x, touch.y - 32);\n    if (mainObject.character.body.speed > 0)\n    {\n        if (distance < 4)\n        {\n            mainObject.character.body.reset(touch.x, touch.y - 32);\n            mainObject.character.play('stand');\n        }\n    }\n}\nfunction InitObject(obj, x, y, origin, setInteractive) {\n    obj.x = x;\n    obj.y = y;\n    obj.setOrigin(origin);\n    if(setInteractive) obj.setInteractive();\n}\nfunction RandomPlusMinus() {\n    return (Math.random() > 0.5) ? 1 : -1;\n}\nfunction RandomizePos(obj, x, y, min, max) {\n    obj.x = x + min + Math.random() * max * RandomPlusMinus();\n    obj.y = y + min + Math.random() * max * RandomPlusMinus();\n}\nfunction ShakeObject(obj, max, speed, time) {\n    if(timer.shaker !== null) return;\n    const x = obj.x;\n    const y = obj.y;\n    setTimeout(()=> {\n        clearTimeout(timer.shaker);\n        timer.shaker = null;\n        obj.x = x;\n        obj.y = y;\n    }, time);\n    repeat();\n    function repeat() {\n        RandomizePos(obj, x, y, 0, max);\n        timer.shaker = setTimeout(repeat, speed);\n    }\n}\nfunction typewriteText(object, txt, speed) {\n    const length = txt.length\n    let i = 0\n    game.scene.scenes[0].time.addEvent({\n        callback: () => {\n            object.text += txt[i]\n            ++i\n        },\n        repeat: length - 1,\n        delay: speed\n    })\n}"],"names":[],"sourceRoot":""}